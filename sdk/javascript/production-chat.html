<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Slime Talks Chat - Production Demo</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Roboto, sans-serif;
                background-color: #ffffff;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .chat-container {
                flex: 1;
                display: flex;
                flex-direction: column;
                max-width: 800px;
                margin: 0 auto;
                height: 100vh;
                background: white;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            }

            .chat-header {
                padding: 20px;
                border-bottom: 1px solid #e5e5e5;
                background: white;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .chat-header h1 {
                font-size: 24px;
                font-weight: 600;
                color: #333;
            }

            .connection-indicator {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 500;
            }

            .connection-indicator.connected {
                background-color: #d4edda;
                color: #155724;
            }

            .connection-indicator.disconnected {
                background-color: #f8d7da;
                color: #721c24;
            }

            .connection-indicator.connecting {
                background-color: #fff3cd;
                color: #856404;
            }

            .connection-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: currentColor;
            }

            .chat-messages {
                flex: 1;
                overflow-y: auto;
                padding: 20px;
                display: flex;
                flex-direction: column;
                gap: 16px;
            }

            .message {
                display: flex;
                align-items: flex-start;
                gap: 12px;
                max-width: 70%;
                animation: messageSlideIn 0.3s ease-out;
            }

            @keyframes messageSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .message.sent {
                align-self: flex-end;
                flex-direction: row-reverse;
            }

            .message.received {
                align-self: flex-start;
            }

            .avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                flex-shrink: 0;
                background-size: cover;
                background-position: center;
                border: 2px solid #f0f0f0;
            }

            .message-content {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }

            .message-bubble {
                padding: 12px 16px;
                border-radius: 18px;
                max-width: 100%;
                word-wrap: break-word;
                position: relative;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            }

            .message.sent .message-bubble {
                background-color: #000000;
                color: white;
                border-bottom-right-radius: 4px;
            }

            .message.received .message-bubble {
                background-color: #f0f0f0;
                color: #333;
                border-bottom-left-radius: 4px;
            }

            .message-text {
                font-size: 16px;
                line-height: 1.4;
            }

            .message-timestamp {
                font-size: 12px;
                color: #999;
                margin-top: 4px;
            }

            .message.sent .message-timestamp {
                text-align: right;
            }

            .message.received .message-timestamp {
                text-align: left;
            }

            .reactions {
                display: flex;
                gap: 4px;
                margin-top: 4px;
            }

            .reaction {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                cursor: pointer;
                transition: transform 0.2s;
                background-color: rgba(0, 0, 0, 0.1);
            }

            .reaction:hover {
                transform: scale(1.1);
            }

            .typing-indicator {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 16px;
                color: #666;
                font-style: italic;
                font-size: 14px;
                animation: typingPulse 1.5s infinite;
            }

            @keyframes typingPulse {
                0%,
                100% {
                    opacity: 0.6;
                }
                50% {
                    opacity: 1;
                }
            }

            .typing-dots {
                display: flex;
                gap: 2px;
            }

            .typing-dot {
                width: 4px;
                height: 4px;
                border-radius: 50%;
                background-color: #666;
                animation: typing 1.4s infinite;
            }

            .typing-dot:nth-child(2) {
                animation-delay: 0.2s;
            }

            .typing-dot:nth-child(3) {
                animation-delay: 0.4s;
            }

            @keyframes typing {
                0%,
                60%,
                100% {
                    transform: translateY(0);
                }
                30% {
                    transform: translateY(-10px);
                }
            }

            .chat-input-container {
                padding: 20px;
                border-top: 1px solid #e5e5e5;
                background: white;
            }

            .chat-input-wrapper {
                display: flex;
                align-items: center;
                gap: 12px;
                background: #f8f8f8;
                border: 1px solid #e0e0e0;
                border-radius: 24px;
                padding: 8px 16px;
                transition: border-color 0.2s;
            }

            .chat-input-wrapper:focus-within {
                border-color: #000000;
            }

            .chat-input {
                flex: 1;
                border: none;
                background: transparent;
                outline: none;
                font-size: 16px;
                padding: 8px 0;
                color: #333;
            }

            .chat-input::placeholder {
                color: #999;
            }

            .chat-input:disabled {
                color: #ccc;
            }

            .emoji-button {
                background: none;
                border: none;
                cursor: pointer;
                font-size: 20px;
                padding: 4px;
                border-radius: 50%;
                transition: background-color 0.2s;
            }

            .emoji-button:hover {
                background-color: #e0e0e0;
            }

            .send-button {
                background: #000000;
                border: none;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s;
            }

            .send-button:hover:not(:disabled) {
                background-color: #333;
                transform: scale(1.05);
            }

            .send-button:disabled {
                background-color: #ccc;
                cursor: not-allowed;
                transform: none;
            }

            .send-icon {
                color: white;
                font-size: 16px;
            }

            .welcome-message {
                text-align: center;
                padding: 40px 20px;
                color: #666;
            }

            .welcome-message h2 {
                font-size: 24px;
                margin-bottom: 8px;
                color: #333;
            }

            .welcome-message p {
                font-size: 16px;
                margin-bottom: 20px;
            }

            .start-chat-button {
                background: #000000;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 24px;
                font-size: 16px;
                font-weight: 500;
                cursor: pointer;
                transition: background-color 0.2s;
            }

            .start-chat-button:hover {
                background-color: #333;
            }

            /* Scrollbar styling */
            .chat-messages::-webkit-scrollbar {
                width: 6px;
            }

            .chat-messages::-webkit-scrollbar-track {
                background: #f1f1f1;
            }

            .chat-messages::-webkit-scrollbar-thumb {
                background: #c1c1c1;
                border-radius: 3px;
            }

            .chat-messages::-webkit-scrollbar-thumb:hover {
                background: #a8a8a8;
            }

            /* Loading animation */
            .loading {
                display: inline-block;
                width: 20px;
                height: 20px;
                border: 3px solid #f3f3f3;
                border-top: 3px solid #000000;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            /* Responsive design */
            @media (max-width: 768px) {
                .chat-container {
                    max-width: 100%;
                    height: 100vh;
                }

                .message {
                    max-width: 85%;
                }

                .chat-header {
                    padding: 15px;
                }

                .chat-header h1 {
                    font-size: 20px;
                }
            }
        </style>
    </head>
    <body>
        <div class="chat-container">
            <div class="chat-header">
                <h1>Micro Communities Chat</h1>
                <div class="connection-indicator" id="connection-status">
                    <div class="connection-dot"></div>
                    <span>Connecting...</span>
                </div>
            </div>

            <div class="chat-messages" id="chat-messages">
                <div class="welcome-message">
                    <h2>Welcome to Slime Talks Chat!</h2>
                    <p>
                        This is a production-ready chat application using the
                        Slime Talks SDK.
                    </p>
                    <button class="start-chat-button" id="start-chat-button">
                        Start Demo Chat
                    </button>
                </div>
            </div>

            <div id="typing-indicators"></div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input
                        type="text"
                        class="chat-input"
                        id="message-input"
                        placeholder="I'll start looking into it!"
                        disabled
                    />
                    <button class="emoji-button" id="emoji-button">😊</button>
                    <button class="send-button" id="send-button" disabled>
                        <span class="send-icon">✈</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Include required libraries -->
        <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
        <script src="slime-talks-realtime.js"></script>
        <script src="slime-talks-sdk.js"></script>
        <script src="chat-app.js"></script>

        <script>
            // Configuration - Replace with your actual credentials
            const CONFIG = {
                apiUrl: "https://api.slime-talks.com/api/v1",
                secretKey: "your-api-secret-key",
                publicKey: "your-api-public-key",
                origin: window.location.origin,
                pusherKey: "your-pusher-key",
                pusherCluster: "us2",
                currentUser: {
                    id: "cus_current_user",
                    name: "You",
                    avatar: null, // Will be auto-generated
                },
            };

            // Demo channel
            const DEMO_CHANNEL = "ch_demo_micro_communities";

            // Global variables
            let chatApp = null;
            let isInitialized = false;

            // DOM elements
            const startChatButton =
                document.getElementById("start-chat-button");
            const chatMessages = document.getElementById("chat-messages");

            // Initialize the application
            async function init() {
                if (isInitialized) return;

                try {
                    // Request notification permission
                    if (
                        "Notification" in window &&
                        Notification.permission === "default"
                    ) {
                        await Notification.requestPermission();
                    }

                    // Initialize chat app
                    chatApp = new SlimeTalksChatApp(CONFIG);
                    isInitialized = true;

                    console.log("Chat application initialized");
                } catch (error) {
                    console.error("Failed to initialize:", error);
                    showError("Failed to initialize chat application");
                }
            }

            // Start demo chat
            async function startDemoChat() {
                try {
                    if (!chatApp) {
                        await init();
                    }

                    // Clear welcome message
                    chatMessages.innerHTML = "";

                    // Join demo channel
                    await chatApp.joinChannel(DEMO_CHANNEL);

                    // Add some demo messages
                    addDemoMessages();

                    // Hide start button
                    startChatButton.style.display = "none";
                } catch (error) {
                    console.error("Failed to start demo chat:", error);
                    showError("Failed to start demo chat");
                }
            }

            // Add demo messages
            function addDemoMessages() {
                const demoMessages = [
                    {
                        id: "msg_demo_1",
                        sender: { id: "cus_sarah", name: "Sarah" },
                        content:
                            "Hey, have you heard about these micro communities people are joining?",
                        created: Math.floor(Date.now() / 1000) - 480, // 8 minutes ago
                        metadata: { reactions: [] },
                    },
                    {
                        id: "msg_demo_2",
                        sender: {
                            id: CONFIG.currentUser.id,
                            name: CONFIG.currentUser.name,
                        },
                        content:
                            "Yeah, I have! They seem like a great alternative to big social media platforms.",
                        created: Math.floor(Date.now() / 1000) - 420, // 7 minutes ago
                        metadata: { reactions: [] },
                    },
                    {
                        id: "msg_demo_3",
                        sender: { id: "cus_sarah", name: "Sarah" },
                        content:
                            "Definitely. I joined one for local gardening enthusiasts. It's so much more engaging.",
                        created: Math.floor(Date.now() / 1000) - 360, // 6 minutes ago
                        metadata: {
                            reactions: [
                                { emoji: "👌", count: 1 },
                                { emoji: "🌿", count: 1 },
                                { emoji: "😊", count: 1 },
                            ],
                        },
                    },
                    {
                        id: "msg_demo_4",
                        sender: {
                            id: CONFIG.currentUser.id,
                            name: CONFIG.currentUser.name,
                        },
                        content:
                            "That's cool. I've been looking to cut down my social media time. How do you like it?",
                        created: Math.floor(Date.now() / 1000) - 120, // 2 minutes ago
                        metadata: { reactions: [] },
                    },
                    {
                        id: "msg_demo_5",
                        sender: { id: "cus_sarah", name: "Sarah" },
                        content: "I love it. More meaningful interactions.",
                        created: Math.floor(Date.now() / 1000) - 1, // just now
                        metadata: { reactions: [] },
                    },
                ];

                // Display demo messages
                demoMessages.forEach((message, index) => {
                    setTimeout(() => {
                        chatApp.displayMessage(message);
                    }, index * 500); // Stagger the messages
                });
            }

            // Show error message
            function showError(message) {
                console.error("Error:", message);

                // Create error message element
                const errorEl = document.createElement("div");
                errorEl.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #f8d7da;
                color: #721c24;
                padding: 12px 20px;
                border-radius: 8px;
                border: 1px solid #f5c6cb;
                z-index: 1000;
                max-width: 400px;
                text-align: center;
            `;
                errorEl.textContent = message;

                document.body.appendChild(errorEl);

                // Remove after 5 seconds
                setTimeout(() => {
                    if (errorEl.parentNode) {
                        errorEl.parentNode.removeChild(errorEl);
                    }
                }, 5000);
            }

            // Event listeners
            startChatButton.addEventListener("click", startDemoChat);

            // Initialize when page loads
            document.addEventListener("DOMContentLoaded", init);

            // Handle page visibility changes
            document.addEventListener("visibilitychange", () => {
                if (document.hidden) {
                    console.log("Page hidden - pausing real-time updates");
                } else {
                    console.log("Page visible - resuming real-time updates");
                }
            });

            // Handle beforeunload
            window.addEventListener("beforeunload", () => {
                if (chatApp) {
                    chatApp.disconnect();
                }
            });
        </script>
    </body>
</html>
